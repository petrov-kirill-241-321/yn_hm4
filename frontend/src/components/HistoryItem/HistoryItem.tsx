import styles from "./HistoryItem.module.css";
import imageDocIcon from "../../assets/docIcon.svg";
import imageTrash from "../../assets/Trash.svg";
import { useState } from "react";
import ModalWindow from "../ModalWindow/ModalWindow";
import type { TableData } from "../../../store/TableStore";

interface Props {
  fileName: string;
  date: string;
  status: boolean;
  id: number;
}

interface TableStore {
  fileName: string;
  currentDate: string;
  isSuccess: boolean;
  tableId: number;
  tableStore: TableData;
}

export default function HistoryItem({ fileName, date, status, id }: Props) {
  const [isOpen, setIsOpen] = useState<boolean>(false);
  const data = localStorage.getItem(`table-${id}`);
  if (!data) return;
  const table: TableStore | null = JSON.parse(data);
  if (!table) return;

  function handlerDeleteStorage(id: number) {
    localStorage.removeItem(`table-${id}`);
    window.dispatchEvent(new Event("storage-change"));
  }

  return (
    <div className={styles.historyItem}>
      <ul className={styles.list} onClick={() => setIsOpen(true)}>
        <li className={styles.item}>
          <img className={styles.image} src={imageDocIcon} alt="док" />
          <p className={styles.text}>{fileName}</p>
        </li>
        <li className={styles.item}>
          <p className={styles.text}>{date}</p>
        </li>
        <li className={`${styles.item} ${status ? "" : styles.error}`}>
          <p className={styles.text}>Обработан успешно</p>
          <svg
            className={`${styles.image} ${status ? "" : styles.error}`}
            width="33"
            height="33"
            viewBox="0 0 33 33"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M16.3468 0.411621C13.1329 0.411621 9.99109 1.36467 7.31879 3.15024C4.64649 4.93581 2.56369 7.47372 1.33377 10.443C0.103843 13.4123 -0.217962 16.6796 0.409048 19.8318C1.03606 22.984 2.58372 25.8795 4.85632 28.1521C7.12893 30.4247 10.0244 31.9724 13.1766 32.5994C16.3288 33.2264 19.5961 32.9046 22.5654 31.6747C25.5347 30.4447 28.0726 28.3619 29.8582 25.6896C31.6438 23.0173 32.5968 19.8756 32.5968 16.6616C32.5923 12.3532 30.8787 8.22264 27.8323 5.17616C24.7858 2.12968 20.6552 0.416171 16.3468 0.411621ZM16.3468 30.4116C13.6273 30.4116 10.9689 29.6052 8.70772 28.0943C6.44654 26.5835 4.68417 24.436 3.64347 21.9235C2.60276 19.411 2.33046 16.6464 2.86101 13.9791C3.39156 11.3119 4.70112 8.86187 6.62409 6.9389C8.54706 5.01593 10.9971 3.70637 13.6643 3.17582C16.3316 2.64528 19.0962 2.91757 21.6087 3.95828C24.1212 4.99898 26.2686 6.76135 27.7795 9.02253C29.2904 11.2837 30.0968 13.9421 30.0968 16.6616C30.0927 20.3071 28.6427 23.802 26.065 26.3798C23.4872 28.9575 19.9923 30.4075 16.3468 30.4116ZM8.84681 13.5366C8.84681 13.1658 8.95677 12.8033 9.1628 12.4949C9.36883 12.1866 9.66167 11.9463 10.0043 11.8043C10.3469 11.6624 10.7239 11.6253 11.0876 11.6976C11.4513 11.77 11.7854 11.9486 12.0476 12.2108C12.3099 12.473 12.4884 12.8071 12.5608 13.1708C12.6331 13.5345 12.596 13.9115 12.4541 14.2542C12.3122 14.5968 12.0718 14.8896 11.7635 15.0956C11.4552 15.3017 11.0926 15.4116 10.7218 15.4116C10.2245 15.4116 9.74761 15.2141 9.39598 14.8624C9.04435 14.5108 8.84681 14.0339 8.84681 13.5366ZM23.8468 13.5366C23.8468 13.9075 23.7368 14.27 23.5308 14.5783C23.3248 14.8867 23.0319 15.127 22.6893 15.2689C22.3467 15.4108 21.9697 15.4479 21.606 15.3756C21.2423 15.3032 20.9082 15.1247 20.646 14.8624C20.3838 14.6002 20.2052 14.2661 20.1328 13.9024C20.0605 13.5387 20.0976 13.1617 20.2395 12.8191C20.3815 12.4765 20.6218 12.1836 20.9301 11.9776C21.2385 11.7716 21.601 11.6616 21.9718 11.6616C22.4691 11.6616 22.946 11.8592 23.2976 12.2108C23.6493 12.5624 23.8468 13.0393 23.8468 13.5366Z" />
            <path d="M23.1704 19.5296C23.8423 19.7798 24.1924 20.5339 23.8435 21.1602C23.206 22.3042 22.3112 23.2918 21.2229 24.0409C19.7764 25.0366 18.0584 25.5626 16.3025 25.5475C14.5465 25.5325 12.8378 24.977 11.4086 23.9566C10.3334 23.189 9.45562 22.1862 8.83791 21.0314C8.49974 20.3992 8.86277 19.6512 9.53884 19.4126C10.2149 19.1739 10.9454 19.5396 11.3246 20.148C11.7366 20.8089 12.2766 21.3862 12.9172 21.8436C13.9123 22.5541 15.1021 22.9408 16.3248 22.9513C17.5474 22.9618 18.7436 22.5955 19.7508 21.9023C20.3992 21.4559 20.949 20.888 21.3723 20.2343C21.7619 19.6325 22.4985 19.2794 23.1704 19.5296Z" />
          </svg>
        </li>
        <li className={`${styles.item} ${status ? styles.error : ""}`}>
          <p className={styles.text}>Не удалось обработать</p>
          <div>
            <svg
              className={`${styles.image} ${status ? styles.error : ""}`}
              width="40"
              height="41"
              viewBox="0 0 40 41"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M20 4.25C16.7861 4.25 13.6443 5.20305 10.972 6.98862C8.29969 8.77419 6.21689 11.3121 4.98696 14.2814C3.75704 17.2507 3.43524 20.518 4.06225 23.6702C4.68926 26.8224 6.23692 29.7179 8.50952 31.9905C10.7821 34.2631 13.6776 35.8107 16.8298 36.4378C19.982 37.0648 23.2493 36.743 26.2186 35.513C29.1879 34.2831 31.7258 32.2003 33.5114 29.528C35.297 26.8557 36.25 23.7139 36.25 20.5C36.2455 16.1916 34.5319 12.061 31.4855 9.01454C28.439 5.96806 24.3084 4.25455 20 4.25ZM20 34.25C17.2805 34.25 14.6221 33.4436 12.3609 31.9327C10.0997 30.4218 8.33737 28.2744 7.29666 25.7619C6.25596 23.2494 5.98366 20.4847 6.51421 17.8175C7.04476 15.1503 8.35432 12.7003 10.2773 10.7773C12.2003 8.85431 14.6503 7.54475 17.3175 7.0142C19.9848 6.48366 22.7494 6.75595 25.2619 7.79666C27.7744 8.83736 29.9218 10.5997 31.4327 12.8609C32.9436 15.1221 33.75 17.7805 33.75 20.5C33.7459 24.1455 32.2959 27.6404 29.7182 30.2182C27.1404 32.7959 23.6455 34.2459 20 34.25ZM12.5 17.375C12.5 17.0042 12.61 16.6416 12.816 16.3333C13.022 16.025 13.3149 15.7846 13.6575 15.6427C14.0001 15.5008 14.3771 15.4637 14.7408 15.536C15.1045 15.6084 15.4386 15.787 15.7008 16.0492C15.9631 16.3114 16.1416 16.6455 16.214 17.0092C16.2863 17.3729 16.2492 17.7499 16.1073 18.0925C15.9654 18.4351 15.725 18.728 15.4167 18.934C15.1084 19.14 14.7458 19.25 14.375 19.25C13.8777 19.25 13.4008 19.0525 13.0492 18.7008C12.6976 18.3492 12.5 17.8723 12.5 17.375ZM27.5 17.375C27.5 17.7458 27.39 18.1084 27.184 18.4167C26.978 18.725 26.6851 18.9654 26.3425 19.1073C25.9999 19.2492 25.6229 19.2863 25.2592 19.214C24.8955 19.1416 24.5614 18.963 24.2992 18.7008C24.037 18.4386 23.8584 18.1045 23.786 17.7408C23.7137 17.3771 23.7508 17.0001 23.8927 16.6575C24.0346 16.3149 24.275 16.022 24.5833 15.816C24.8917 15.61 25.2542 15.5 25.625 15.5C26.1223 15.5 26.5992 15.6975 26.9508 16.0492C27.3025 16.4008 27.5 16.8777 27.5 17.375ZM27.3313 27.375C27.4217 27.5173 27.4824 27.6764 27.5098 27.8427C27.5372 28.0091 27.5306 28.1792 27.4905 28.343C27.4504 28.5067 27.3775 28.6607 27.2764 28.7955C27.1753 28.9304 27.0479 29.0434 26.9019 29.1278C26.756 29.2122 26.5944 29.2661 26.4271 29.2865C26.2597 29.3068 26.09 29.2931 25.9281 29.2461C25.7662 29.1991 25.6154 29.1199 25.4849 29.0131C25.3545 28.9064 25.2469 28.7744 25.1688 28.625C24.0016 26.6078 22.1672 25.5 20 25.5C17.8328 25.5 15.9984 26.6094 14.8313 28.625C14.7531 28.7744 14.6456 28.9064 14.5151 29.0131C14.3846 29.1199 14.2338 29.1991 14.0719 29.2461C13.91 29.2931 13.7403 29.3068 13.5729 29.2865C13.4056 29.2661 13.2441 29.2122 13.0981 29.1278C12.9521 29.0434 12.8248 28.9304 12.7236 28.7955C12.6225 28.6607 12.5497 28.5067 12.5095 28.343C12.4694 28.1792 12.4629 28.0091 12.4902 27.8427C12.5176 27.6764 12.5783 27.5173 12.6688 27.375C14.2766 24.5953 16.9484 23 20 23C23.0516 23 25.7234 24.5938 27.3313 27.375Z" />
            </svg>
          </div>
        </li>
      </ul>
      <div onClick={() => handlerDeleteStorage(id)} className={styles.trash}>
        <img className={styles.trashImage} src={imageTrash} alt="удалить" />
      </div>
      <ModalWindow
        isOpen={isOpen}
        setIsOpen={setIsOpen}
        average_spend_galactic={table?.tableStore.average_spend_galactic}
        big_spent_at={table.tableStore.big_spent_at}
        big_spent_civ={table.tableStore.big_spent_civ}
        big_spent_value={table.tableStore.big_spent_value}
        less_spent_at={table.tableStore.less_spent_at}
        less_spent_civ={table.tableStore.less_spent_civ}
        less_spent_value={table.tableStore.less_spent_value}
        rows_affected={table.tableStore.rows_affected}
        total_spend_galactic={table.tableStore.total_spend_galactic}
      />
    </div>
  );
}
